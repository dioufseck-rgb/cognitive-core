# Structuring SAR — Agentic Domain Configuration
domain_name: structuring_sar_agentic
workflow: sar_investigation_agentic
description: >
  Agentic SAR investigation for structuring alerts. Orchestrator adapts
  investigation depth and decides filing recommendation.

goal: |
  Investigate a suspicious activity alert and determine whether a SAR
  filing is warranted. If yes, produce a FinCEN-compliant SAR narrative.
  If no, produce a documented decision not to file.

  BSA/AML requirements apply. All analysis must be documented.
  The narrative MUST be challenged and verified before delivery.

orchestrator_strategy: |
  SEQUENCING GUIDANCE:
  - Classify the alert type first (structuring, layering, unusual, etc.)
  - If confidence < 0.5 on classification → escalate to BSA officer.
  - Investigate the activity. For structuring, look for patterns just
    below CTR thresholds, round amounts, timing patterns.
  - After investigation, classify filing decision (file, no-file, escalate).
  - If filing: generate SAR narrative per FinCEN requirements.
  - If complex (multiple account types, cross-border, shell companies),
    use THINK to synthesize before generating.
  - Challenge the narrative for accuracy, completeness, and compliance.
  - Verify the narrative against the SAR checklist.

primitive_configs:

  classify_alert:
    primitive: classify
    temperature: 0.05
    params:
      categories: |
        - structuring: Transactions designed to evade CTR reporting ($10K threshold).
        - layering: Moving funds through multiple accounts to obscure origin.
        - unusual_pattern: Activity inconsistent with member's profile.
        - high_risk_geography: Transactions involving high-risk jurisdictions.
        - third_party_funnel: Account used as pass-through for others.
      criteria: |
        Alert: ${input.alert_type} (score: ${input.alert_score})
        Subject: ${input.subject}
        Triggering activity: ${input.triggering_activity}
        Focus on: amounts relative to CTR threshold, timing, round numbers.
      confidence_threshold: "0.7"

  investigate_activity:
    primitive: investigate
    params:
      question: |
        Is this activity consistent with legitimate operations or does it
        indicate potential illicit activity warranting a SAR filing?
        Alert type: ${_last_classify.category}
      scope: |
        1. TRANSACTION PATTERNS: Amounts, timing, frequency, round numbers
        2. CTR AVOIDANCE: Transactions just below $10K threshold
        3. MEMBER PROFILE: Does activity match stated occupation/income?
        4. ACCOUNT HISTORY: Is this a change in behavior?
        5. CONNECTIONS: Related accounts, beneficiaries, counterparties
        6. LEGITIMATE EXPLANATIONS: Cash business, cultural factors, life events
      available_evidence: |
        Alert: ${input.alert_type}
        Transactions: ${input.triggering_activity}
        Subject: ${input.subject}
      effort_level: deep

  classify_filing_decision:
    primitive: classify
    temperature: 0.05
    params:
      categories: |
        - file_sar: Activity is suspicious and requires SAR filing.
        - no_file_document: Activity has legitimate explanation, document decision.
        - escalate_bsa_officer: Complex case requiring BSA officer review.
      criteria: |
        Investigation: ${_last_investigate.finding}
        Alert type: ${_last_classify.category}
        Consider: Is there a legitimate explanation? Has the member been
        interviewed? Are there corroborating red flags or mitigating factors?
      confidence_threshold: "0.8"

  think_synthesis:
    primitive: think
    temperature: 0.2
    params:
      instruction: |
        Complex SAR case. Consider:
        - Alert: ${_last_classify.category}
        - Investigation: ${_last_investigate.finding}
        - Member profile: ${input.subject}

        Think through:
        1. Strength of evidence for suspicious activity
        2. Strength of legitimate explanations
        3. Would a reasonable BSA officer file based on this evidence?
        4. What additional information would change the decision?
        5. If filing, what are the key facts for the narrative?
      focus: Defensible decision-making. Document reasoning clearly.

  generate_sar_narrative:
    primitive: generate
    temperature: 0.1
    params:
      requirements: |
        Investigation: ${_last_investigate.finding}
        Filing decision: ${_last_classify.category}

        Generate FinCEN-compliant SAR narrative:
        1. Subject information
        2. Suspicious activity description (who, what, when, where, why, how)
        3. Transaction details with specific amounts and dates
        4. Why the activity is suspicious
        5. Actions taken by the institution
        6. Related accounts or subjects
      format: sar_narrative
      constraints: |
        - Factual, objective tone — no conclusions about criminal intent
        - Specific amounts, dates, and transaction details
        - Do not include privileged or investigative methodology
        - Under 2000 characters per FinCEN guidance
        - No member interview results unless interview occurred

  generate_no_file:
    primitive: generate
    temperature: 0.1
    params:
      requirements: |
        Document the decision NOT to file a SAR:
        1. Alert details
        2. Investigation conducted
        3. Legitimate explanation found
        4. Reasoning for no-file decision
        5. Reviewer name placeholder
      format: no_file_documentation
      constraints: |
        - Must be defensible to examiners
        - Document what WAS investigated, not just the conclusion

  challenge_narrative:
    primitive: challenge
    model: gemini-2.5-pro
    temperature: 0.05
    params:
      input: "${_last_generate.artifact}"
      perspective: |
        1. BSA EXAMINER: Is this narrative complete per FinCEN requirements?
           Does it answer who/what/when/where/why/how?
        2. DEFENSE ATTORNEY: Could any statement be challenged as speculative
           or unsupported by the transaction data?
        3. LAW ENFORCEMENT: Would this narrative be useful for investigation?
      threat_model: |
        CRITICAL: Missing key transaction details, speculating about intent,
          including privileged information, factual errors
        HIGH: Incomplete who/what/when/where/why/how, missing related accounts,
          no explanation of why activity is suspicious
        MEDIUM: Could be more specific, missing minor details

  verify_sar_checklist:
    primitive: verify
    temperature: 0.0
    params:
      input: "${_last_generate.artifact}"
      rules: |
        1. Subject identified with available information
        2. Suspicious activity described with specifics
        3. Dollar amounts and dates included
        4. Explanation of why activity is suspicious
        5. No speculation about criminal intent
        6. No privileged/investigative methodology
        7. Under 2000 characters
        8. Objective, factual tone throughout
