# Member Complaint — Agentic Domain Configuration
domain_name: member_complaint_agentic
workflow: complaint_resolution_agentic
description: >
  Agentic complaint resolution. Orchestrator adapts investigation
  depth to complaint severity and decides remediation path.

goal: |
  Process a member complaint and produce an appropriate response.
  The member has contacted us with a complaint. Their statement,
  account context, and interaction history are in the case data.

  Your final deliverable is EITHER:
  1. A member-facing response letter with specific remediation, OR
  2. A senior leadership escalation brief if the complaint involves
     regulatory risk or requires authority beyond automated resolution.

  REGULATORY: UDAAP applies — no misleading statements.
  The response MUST be challenged before delivery.

orchestrator_strategy: |
  SEQUENCING GUIDANCE:
  - Classify the complaint type first, then severity.
  - If critical → investigate deeply, consider Think to weigh escalation.
  - If high-priority with financial harm → investigate root cause and
    remediation, then generate a strong response with specific remediation.
  - If standard → investigate, generate, challenge.
  - Use THINK when the complaint involves multiple failures, financial
    harm AND retention risk, or when the right remediation isn't obvious.
  - If the member mentions closing accounts, legal action, or regulators,
    Think about whether to escalate vs resolve directly.
  - Generate an escalation brief (generate_escalation) if Think concludes
    the case needs senior authority.

primitive_configs:

  classify_complaint:
    primitive: classify
    temperature: 0.05
    params:
      categories: |
        - service_inconsistency: Conflicting information from different agents.
        - fee_dispute: Disputes a fee or charge.
        - process_failure: Process didn't work as designed.
        - multi_issue: Spans multiple complaint categories.
        - staff_conduct: Complaint about staff behavior.
      criteria: |
        Classify the ROOT problem, not surface frustration.
        If fees resulted from a process failure, classify as process_failure.
        Complaint: ${input.complaint_text}
        Member: ${input.member_profile.name}, ${input.member_profile.tenure_years}yr
      confidence_threshold: "0.7"

  classify_severity:
    primitive: classify
    temperature: 0.05
    params:
      categories: |
        - critical_escalation: Regulatory risk, legal threat, or 3+ contacts
          without resolution AND financial harm AND high attrition risk.
        - high_priority: Financial harm occurred, member mentions closing accounts,
          or tenure > 5yr with relationship > $25K.
        - standard: Normal complaint within SLA.
      criteria: |
        Complaint type: ${_last_classify.category}
        Complaint: ${input.complaint_text}
        Calls in last 30 days: ${input.interaction_history.calls_last_30_days}
        Total fees: $${input.account_context.total_fees}
        Attrition risk: ${input.member_profile.attrition_risk_score}
        Relationship value: $${input.member_profile.total_relationship_value}
      confidence_threshold: "0.7"

  investigate_root_cause:
    primitive: investigate
    params:
      question: |
        What went wrong and what remediation is appropriate?
        Type: ${_last_classify.category}
      scope: |
        1. ROOT CAUSE: Timeline from member's perspective. What failed?
        2. FINANCIAL IMPACT: Quantify all harm — fees, bounced payments.
        3. SERVICE FAILURE: Agent error, system error, or training gap?
        4. REMEDIATION: Fee reversal amount, apology level, process fix.
        5. RETENTION: Is $50 in fees worth losing a $45K relationship?
      available_evidence: |
        Complaint: ${input.complaint_text}
        Account: ${input.account_context}
        History: ${input.interaction_history}
        Profile: ${input.member_profile}
      effort_level: deep

  think_remediation:
    primitive: think
    temperature: 0.2
    params:
      instruction: |
        Consider the complaint, investigation findings, and member context:
        - Complaint: ${input.complaint_text}
        - Investigation: ${_last_investigate.finding}
        - Member: ${input.member_profile.tenure_years}yr, $${input.member_profile.total_relationship_value}
        - Attrition risk: ${input.member_profile.attrition_risk_score}
        - Financial harm: $${input.account_context.total_fees}

        Think through:
        1. Should this be resolved directly or escalated?
        2. Is fee reversal sufficient, or does this need more?
        3. What's the retention math? Cost of losing this member vs remediation.
        4. Are there UDAAP or regulatory concerns in how we respond?
        5. What would make this member stay AND feel good about staying?
      focus: |
        Balance member retention with appropriate remediation.
        Don't over-compensate, but don't under-compensate either.

  generate_response:
    primitive: generate
    temperature: 0.3
    params:
      requirements: |
        Member: ${input.member_profile.name} (${input.member_profile.tenure_years}yr member)
        Investigation: ${_last_investigate.finding}

        Response MUST:
        1. Acknowledge frustration specifically
        2. Take responsibility — don't deflect
        3. Explain what happened in plain language
        4. State exact remediation (fee reversal amounts, etc.)
        5. Explain prevention measures
        6. Provide direct contact for follow-up
        7. Reaffirm member's value

        TONE: Sincere, direct, action-oriented. Not corporate script.
      format: member_response_letter
      constraints: |
        - Never blame the member
        - Never use "per our policy"
        - Include specific dollar amounts
        - Under 400 words
        - 8th grade reading level
        - UDAAP: no misleading statements

  generate_escalation:
    primitive: generate
    temperature: 0.1
    params:
      requirements: |
        Member: ${input.member_profile.name} (${input.member_profile.tenure_years}yr)
        Create escalation brief:
        1. Member's situation in their words
        2. Financial impact and timeline
        3. Regulatory risk assessment
        4. Recommended resolution
        5. Retention analysis
        6. Authority level needed
      format: escalation_brief
      constraints: |
        - Internal only, not member-facing
        - Flag regulatory triggers
        - Include member's stated intent

  challenge_response:
    primitive: challenge
    model: gemini-2.5-pro
    temperature: 0.05
    params:
      input: "${_last_generate.artifact}"
      perspective: |
        1. THE MEMBER: Do I feel heard? Is the remediation sufficient?
        2. COMPLIANCE: Any UDAAP concerns? Accurate explanation?
        3. RETENTION: Given $45K relationship and 0.6 attrition risk,
           is this enough to keep them?
      threat_model: |
        CRITICAL: Blaming member, factual errors, missing remediation, UDAAP
        HIGH: Generic apology, missing fee reversal, no follow-up contact
        MEDIUM: Too long, no process improvement mention
