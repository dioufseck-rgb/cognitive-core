# Cardiac Triage — Agentic Domain Configuration
domain_name: cardiac_triage_agentic
workflow: nurse_triage_agentic
description: >
  Agentic triage for cardiac symptoms. Orchestrator adapts investigation
  depth to risk factors and may use Think for ambiguous presentations.

goal: |
  Triage a patient call about potential cardiac symptoms.
  Produce a nurse telephone script with clear, safe guidance.

  Safety is paramount. When cardiac and GI symptoms overlap, err
  toward cardiac. When in doubt, triage UP.

  MUST verify guidance safety against Schmitt-Thompson protocols
  before generating the script. MUST challenge the final script.

orchestrator_strategy: |
  SEQUENCING GUIDANCE:
  - Classify symptoms first, then urgency.
  - If emergent → short investigation, verify safety, generate 911 script.
  - If urgent → investigate clinical picture, verify, generate ED script.
  - If ambiguous presentation (cardiac vs GI overlap, atypical symptoms),
    use THINK to reason through the differential before generating.
  - ALWAYS verify guidance safety before generating.
  - Never skip verification — this is safety-critical.
  - If verification fails, escalate rather than generating unsafe guidance.

primitive_configs:

  classify_symptoms:
    primitive: classify
    temperature: 0.05
    params:
      categories: |
        - cardiac: Chest pain/pressure, arm/jaw pain, SOB, diaphoresis.
        - respiratory: Primary breathing difficulty without cardiac indicators.
        - gastrointestinal: Abdominal pain, nausea, heartburn, reflux.
        - musculoskeletal: Movement/injury-related pain.
        - neurological: Headache, dizziness, numbness.
        - psychiatric: Anxiety, panic attack.
      criteria: |
        Location, quality, radiation of pain. Associated symptoms.
        When cardiac and GI overlap, err toward cardiac.
        Patient: ${input.caller_name}, ${input.caller_age}yo ${input.caller_sex}
        Complaint: ${input.chief_complaint}
        History: ${input.patient_history}
      confidence_threshold: "0.7"

  classify_urgency:
    primitive: classify
    temperature: 0.05
    params:
      categories: |
        - emergent_call_911: Life-threatening. Call 911 immediately.
        - urgent_ed_now: ED within 1-2 hours.
        - urgent_same_day: Medical evaluation today.
        - routine_24_48h: Seen within 1-2 days.
        - self_care: Manage at home.
      criteria: |
        Symptom category: ${_last_classify.category}
        Patient: ${input.caller_age}yo ${input.caller_sex}
        History: ${input.patient_history}
        Vitals: ${input.vitals_if_available}
        Chest pressure + SOB in male 40+ with risk factors = EMERGENT.
        2am onset = more conservative. When in doubt, triage UP.
      confidence_threshold: "0.8"

  investigate_clinical:
    primitive: investigate
    params:
      question: |
        Symptoms: ${_last_classify.category}
        What is the most likely clinical picture and differential?
      scope: |
        1. Primary differentials ranked by likelihood and severity
        2. Historical risk factors supporting/against each
        3. Red flags present and red flags to ask about
        4. Time-sensitive considerations
      available_evidence: |
        Complaint: ${input.chief_complaint}
        History: ${input.patient_history}
        Vitals: ${input.vitals_if_available}
      effort_level: moderate

  think_differential:
    primitive: think
    temperature: 0.2
    params:
      instruction: |
        This presentation is ambiguous. Consider:
        - Symptoms: ${_last_classify.category}
        - Clinical findings: ${_last_investigate.finding}
        - Patient: ${input.caller_age}yo ${input.caller_sex}
        - History: ${input.patient_history}

        Think through the differential. Could this be cardiac even if
        it presents atypically? What would a cautious clinician do?
        When safety is at stake, recommend the more conservative path.
      focus: Patient safety above all else.

  verify_guidance_safety:
    primitive: verify
    temperature: 0.0
    params:
      input: |
        Triage level: ${_last_classify.category}
        Clinical assessment: ${_last_investigate.finding}
        Patient: ${input.caller_age}yo ${input.caller_sex}
        History: ${input.patient_history}
      rules: |
        1. Schmitt-Thompson: urgency matches published protocols?
        2. Cardiac protocol: male 40+ with pressure/SOB/risk factors = emergent
        3. Medication safety: no conflict with current meds/allergies
        4. Night onset: more conservative triage
        5. Never "wait and see" for cardiac symptoms in high-risk
        6. If emergent: must include 911, not self-drive
        7. Aspirin: if cardiac suspected and no contraindication, include

  generate_script:
    primitive: generate
    temperature: 0.3
    params:
      requirements: |
        Caller: ${input.caller_name}, ${input.caller_age}yo
        Triage: ${_last_classify.category}
        Clinical: ${_last_investigate.finding}
        Safety verified: ${_last_verify.reasoning}

        Script must: stay calm but convey urgency, validate the call,
        give clear instructions for RIGHT NOW, address "overreacting"
        concern, guidance for family members.
      format: telephone_nurse_script
      constraints: |
        - Plain language, no medical jargon
        - If 911: say so directly, first sentence
        - Include dos and don'ts while waiting
        - Never minimize cardiac symptoms

  generate_escalation:
    primitive: generate
    temperature: 0.1
    params:
      requirements: |
        Patient: ${input.caller_name}, ${input.caller_age}yo
        Safety verification FAILED. Generate clinical escalation.
        Include: what was concerning, why automated guidance is unsafe,
        recommended physician review.
      format: clinical_escalation
      constraints: |
        - Flag specific safety rule violations
        - Include all patient details for physician

  challenge_script:
    primitive: challenge
    model: gemini-2.5-pro
    temperature: 0.05
    params:
      input: "${_last_generate.artifact}"
      perspective: |
        1. PATIENT SAFETY: Would following this script lead to the safest
           outcome? Could any instruction cause harm or delay?
        2. CLINICAL ACCURACY: Does the urgency match the symptoms?
        3. COMMUNICATION: Would a scared caller at 2am understand this?
      threat_model: |
        CRITICAL: Undertriage (telling emergent to wait), medication conflict,
          missing 911 for cardiac in high-risk, telling patient to drive
        HIGH: Missing aspirin instruction, unclear timing, missing red flags
        MEDIUM: Tone not calming enough, too much jargon
