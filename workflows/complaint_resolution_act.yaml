name: complaint_resolution_act
description: 'End-to-end complaint resolution that closes the loop â€” classifies the complaint, investigates, generates a response,
  validates it through adversarial challenge, then SENDS the response to the member via email.

  '
steps:
- name: classify_complaint
  primitive: classify
  params:
    categories: ${domain.classify_complaint.categories}
    criteria: 'Complaint: ${input.complaint.description}

      Subject: ${input.complaint.subject}

      Member: ${input.member_profile.name} (member since ${input.member_profile.member_since})

      ${domain.classify_complaint.criteria}

      '
    confidence_threshold: '0.7'
  temperature: 0.0
- name: classify_severity
  primitive: classify
  params:
    categories: ${domain.classify_severity.categories}
    criteria: 'Complaint type: ${classify_complaint.category}

      Severity indicators: ${input.complaint.severity_indicators}

      Sentiment: ${input.complaint.sentiment}

      Prior complaints: ${input.complaint.prior_complaints}

      Relationship value: $${input.member_profile.relationship_value}

      Tenure: ${input.member_profile.membership_tenure_years} years

      Financial impact: Check hold of $${input.check_deposit_detail.check_amount}, NSF fee of $${input.account_detail.recent_nsf}

      ${domain.classify_severity.criteria}

      '
  transitions:
  - when: output.category == 'critical_escalation'
    goto: escalate_to_human
  - default: investigate_complaint
  temperature: 0.0
- name: investigate_complaint
  primitive: investigate
  params:
    question: 'Member ${input.member_profile.name} filed a ${classify_complaint.category}

      complaint (severity: ${classify_severity.category}) about a check

      deposit hold. What happened, is the hold justified, and what

      remediation is appropriate?

      '
    scope: ${domain.investigate_complaint.scope}
    available_evidence: 'Complaint: ${input.complaint.description}

      Check deposit: ${input.check_deposit_detail}

      Account: ${input.account_detail}

      Member history: ${input.member_history}

      Hold reason: ${input.check_deposit_detail.hold_reason}

      '
    effort_level: thorough
- name: generate_response
  primitive: generate
  max_loops: 3
  params:
    requirements: 'Write an email response to ${input.member_profile.name} addressing

      their complaint about the check deposit hold.

      Investigation finding: ${investigate_complaint.finding}

      Remediation: ${investigate_complaint.recommended_actions}

      ${domain.generate_response.requirements}

      '
    format: member_email
    constraints: ${domain.generate_response.constraints}
  transitions:
  - default: challenge_response
- name: challenge_response
  primitive: challenge
  max_loops: 3
  params:
    input: ${generate_response.artifact}
    perspective: ${domain.challenge_response.perspective}
    threat_model: ${domain.challenge_response.threat_model}
  transitions:
  - when: output.survives == true
    goto: send_response
  - when: output.survives == false
    goto: generate_response
  - default: send_response
- name: send_response
  primitive: act
  dry_run: false
  params:
    actions: ${domain.send_response.actions}
    authorization: ${domain.send_response.authorization}
    mode: execution
    additional_instructions: 'The approved email to send is: ${generate_response.artifact}

      Recipient email: ${input.member_profile.email}

      Recipient name: ${input.member_profile.name}

      Complaint ID: ${input.complaint.complaint_id}

      Send this email NOW using the send_email action.

      In your response, set the action to "send_email" and include

      recipient, subject, and body in the response_data field.

      '
  transitions:
  - default: __end__
- name: escalate_to_human
  primitive: generate
  params:
    requirements: 'Member: ${input.member_profile.name}

      Complaint: ${classify_complaint.category}

      Severity: ${classify_severity.category}

      ${domain.escalate_to_human.requirements}

      '
    format: escalation_summary
    constraints: ${domain.escalate_to_human.constraints}
  transitions:
  - default: __end__
